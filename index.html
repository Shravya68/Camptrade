<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampTrade - Student Marketplace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        .item-card-image {
            aspect-ratio: 4 / 3;
            object-fit: cover;
        }
        
        .filter-btn.active {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        /* --- MODIFIED HERO STYLE --- */
        /* Reverted to a white card with padding and shadow */
        .hero-section {
            background-color: #ffffff; /* White */
            border-radius: 12px;
            padding: 4rem 2rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); /* shadow-lg */
        }
        /* --- END HERO STYLE --- */

        /* Styles for item badges */
        .item-card-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 4px 10px;
            border-radius: 9999px; /* pill shape */
            font-size: 0.75rem; /* 12px */
            font-weight: 600;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge-sell { background-color: #2563eb; } /* blue */
        .badge-rent { background-color: #16a34a; } /* green */
        .badge-donate { background-color: #c026d3; } /* fuchsia */
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-blue-600">CampTrade</a>
            
            <div class="hidden md:flex items-center space-x-6">
                <a href="index.html" class="text-blue-600 font-semibold flex items-center gap-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>
                    Browse
                </a>
                <a href="sell.html" class="text-gray-600 hover:text-blue-600 flex items-center gap-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" /><path stroke-linecap="round" stroke-linejoin="round" d="M6 9h.008v.008H6V9z" /></svg>
                    Sell
                </a>
                <a href="rent.html" class="text-gray-600 hover:text-blue-600 flex items-center gap-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.924-.644 1.487-.732z" /></svg>
                    Rent
                </a>
                <a href="donate.html" class="text-gray-600 hover:text-blue-600 flex items-center gap-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" /></svg>
                    Donate
                </a>
                <a href="wishlist.html" class="text-gray-600 hover:text-blue-600 flex items-center gap-1.5">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0111.186 0z" /></svg>
                    Wishlist
                </a>
            </div>
            <div id="auth-links" class="flex items-center space-x-4">
                <a href="login.html" class="px-4 py-2 text-gray-700 font-semibold border border-gray-300 rounded-lg hover:bg-gray-100">Log In</a>
                <a href="signup.html" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">Sign Up</a>
            </div>
            <div id="user-menu" class="hidden items-center space-x-4">
                 <a href="profile.html" id="profileLink" class="font-semibold text-gray-700 hover:text-blue-600"></a>
                 <button id="logoutBtn" class="px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600">Log Out</button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        <section class="text-center mb-20 hero-section">
            <h1 class="text-5xl font-bold mb-4">The Exclusive Marketplace for Students</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-8">Buy, sell, rent, and donate items right on your campus. Safe, easy, and built for you.</p>
            <div class="space-x-4">
                <a href="#browse" class="bg-blue-600 text-white font-semibold px-8 py-3 rounded-lg hover:bg-blue-700">Start Browsing</a>
                <a href="sell.html" class="bg-gray-200 text-gray-800 font-semibold px-8 py-3 rounded-lg hover:bg-gray-300">List an Item</a>
            </div>
        </section>
        <section id="browse">
            <h2 class="text-3xl font-bold text-center mb-6">Recent Listings</h2>
            
            <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-12">
                <div id="filter-container" class="flex flex-wrap justify-center gap-2">
                     <button class="filter-btn active px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-full flex items-center gap-2" data-category="all">
                        All
                     </button>
                     <button class="filter-btn px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-full flex items-center gap-2" data-category="books">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18c-2.305 0-4.408.867-6 2.292m0-14.25v14.25" /></svg>
                        Textbooks
                     </button>
                     <button class="filter-btn px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-full flex items-center gap-2" data-category="electronics">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" /></svg>
                        Electronics
                     </button>
                     <button class="filter-btn px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-full flex items-center gap-2" data-category="stationery">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>
                        Stationery
                     </button>
                     <button class="filter-btn px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-full flex items-center gap-2" data-category="lab">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                        Lab Equipment
                     </button>
                     <button class="filter-btn px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-full flex items-center gap-2" data-category="other">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" /></svg>
                        Other
                     </button>
                </div>
                <div class="w-full md:w-1.3">
                    <input type="text" id="searchInput" class="w-full px-4 py-2 border border-gray-300 rounded-full" placeholder="Search for items...">
                </div>
            </div>

            <div id="itemListings" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <p class="text-center col-span-full text-gray-500">Loading listings...</p>
            </div>
        </section>
    </main>
    
    <footer class="bg-gray-800 text-white mt-20">
        <div class="container mx-auto px-6 py-8 text-center">
            <p>&copy; 2025 CampTrade. Built by students, for students.</p>
        </div>
    </footer>

    <script type="module">
        const firebaseConfig = {
          apiKey: "AIzaSyCqtPN9O7vnxltylayJzoXY8n_5A9T2D4k",
          authDomain: "camptrade-1f932.firebaseapp.com",
          projectId: "camptrade-1f932",
          storageBucket: "camptrade-1f932.appspot.com",
          messagingSenderId: "990486537343",
          appId: "1:990486537343:web:46ba92fe33690d7ebd0b4a"
        };
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const authLinks = document.getElementById('auth-links');
        const userMenu = document.getElementById('user-menu');
        const profileLink = document.getElementById('profileLink');
        const logoutButton = document.getElementById('logoutBtn');
        const itemListingsContainer = document.getElementById('itemListings');
        const searchInput = document.getElementById('searchInput');
        const filterContainer = document.getElementById('filter-container');

        let allItems = []; // Store all items globally

        // Fetches user's name
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authLinks.classList.add('hidden');
                userMenu.classList.remove('hidden');
                userMenu.classList.add('flex');
                
                const userRef = ref(db, 'users/' + user.uid);
                get(userRef).then((snapshot) => {
                    if (snapshot.exists() && snapshot.val().name) {
                        profileLink.textContent = snapshot.val().name;
                    } else {
                        profileLink.textContent = user.email;
                    }
                }).catch((error) => {
                    console.error("Error fetching user profile:", error);
                    profileLink.textContent = user.email;
                });

            } else {
                authLinks.classList.remove('hidden');
                userMenu.classList.add('hidden');
                userMenu.classList.remove('flex');
            }
        });

        logoutButton.addEventListener('click', async () => {
            await signOut(auth);
            window.location.reload();
        });

        // Renders items with badges
        const renderItems = (itemsToRender) => {
            itemListingsContainer.innerHTML = '';
            if (itemsToRender.length > 0) {
                for (const item of itemsToRender) {
                    
                    let priceHTML = '';
                    let badgeHTML = ''; 

                    if (item.type === 'donate') {
                        priceHTML = `<p class="font-bold text-green-600 text-xl mt-2">Free (Donation)</p>`;
                        badgeHTML = `<div class="item-card-badge badge-donate">Donate</div>`;
                    } else if (item.type === 'rent') {
                        priceHTML = `<p class="font-bold text-blue-600 text-xl mt-2">₹${item.price} / day</p>`;
                        badgeHTML = `<div class="item-card-badge badge-rent">Rent</div>`;
                    } else { // 'sell'
                        priceHTML = `<p class="font-bold text-blue-600 text-xl mt-2">₹${item.price}</p>`;
                        badgeHTML = `<div class="item-card-badge badge-sell">Sell</div>`;
                    }

                    const itemCard = `
                        <a href="item.html?id=${item.id}&type=${item.type}" class="block bg-white rounded-lg shadow-lg overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-xl relative">
                            
                            ${badgeHTML} <img src="${item.imageUrl}" alt="${item.title}" class="w-full h-48 item-card-image" onerror="this.onerror=null;this.src='https://placehold.co/400x300/e2e8f0/334155?text=Image+Not+Found';">
                            <div class="p-4">
                                <h3 class="font-semibold text-lg truncate">${item.title}</h3>
                                <p class="text-gray-600 text-sm truncate">${item.description}</p>
                                ${priceHTML}
                                <p class="text-xs text-gray-500 mt-2">Listed by: ${item.sellerEmail || item.listerEmail || item.donatorEmail}</p>
                            </div>
                        </a>
                    `;
                    itemListingsContainer.innerHTML += itemCard;
                }
            } else {
                itemListingsContainer.innerHTML = '<p class="text-center col-span-full text-gray-500">No items match your search.</p>';
            }
        };

        const filterAndRender = () => {
            const searchTerm = searchInput.value.toLowerCase();
            const activeCategory = filterContainer.querySelector('.active').dataset.category;

            const filteredItems = allItems.filter(item => {
                const titleMatch = item.title.toLowerCase().includes(searchTerm);
                const categoryMatch = activeCategory === 'all' || item.category === activeCategory;
                return titleMatch && categoryMatch;
            });
            renderItems(filteredItems);
        };
        
        searchInput.addEventListener('input', filterAndRender);
        filterContainer.addEventListener('click', (e) => {
            // Updated to handle clicks on the button or its children (like the SVG)
            const button = e.target.closest('.filter-btn');
            if (button) {
                filterContainer.querySelector('.active').classList.remove('active');
                button.classList.add('active');
                filterAndRender();
            }
        });

        const fetchAllItems = async () => {
            const itemsRef = ref(db, 'items');
            const rentItemsRef = ref(db, 'rent-items');
            const donateItemsRef = ref(db, 'donation-items');
            try {
                const [sellSnapshot, rentSnapshot, donateSnapshot] = await Promise.all([
                    get(itemsRef), get(rentItemsRef), get(donateItemsRef)
                ]);
                const sellData = sellSnapshot.val() || {};
                const rentData = rentSnapshot.val() || {};
                const donateData = donateSnapshot.val() || {};
                allItems = [
                    ...Object.entries(sellData).map(([id, item]) => ({ id, ...item, type: 'sell' })),
                    ...Object.entries(rentData).map(([id, item]) => ({ id, ...item, type: 'rent' })),
                    ...Object.entries(donateData).map(([id, item]) => ({ id, ...item, type: 'donate' }))
                ].sort((a, b) => b.createdAt - a.createdAt); // Sort by newest first
                
                renderItems(allItems);
            } catch (error) {
                console.error("Error fetching items:", error);
                itemListingsContainer.innerHTML = '<p class="text-center col-span-full text-red-500">Could not load items. Please try again later.</p>';
            }
        };

        fetchAllItems();
    </script>
</body>
</html>